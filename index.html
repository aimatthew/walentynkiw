<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíï Dla Wikusi üíï</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            position: relative;
        }

        /* ===== T≈ÅO ===== */
        
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .bg-base {
            background: 
                radial-gradient(ellipse at 10% 20%, rgba(120, 50, 80, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 80%, rgba(180, 80, 100, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(60, 20, 40, 0.2) 0%, transparent 70%),
                linear-gradient(180deg, #1a0a10 0%, #2d1520 30%, #3d1f2d 60%, #2a1018 100%);
            z-index: 1;
        }

        .bg-aurora {
            z-index: 2;
            opacity: 0.4;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 100, 150, 0.1) 50%, transparent 100%);
            animation: auroraMove 15s ease-in-out infinite;
        }

        @keyframes auroraMove {
            0%, 100% { transform: translateX(-30%) rotate(-5deg) scale(1.5); opacity: 0.3; }
            50% { transform: translateX(30%) rotate(5deg) scale(1.5); opacity: 0.5; }
        }

        .bg-bokeh { z-index: 3; }

        .bokeh-circle {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            animation: bokehFloat 20s infinite ease-in-out;
        }

        .bokeh-circle:nth-child(1) { width: 300px; height: 300px; background: rgba(255, 100, 130, 0.15); top: 10%; left: 5%; }
        .bokeh-circle:nth-child(2) { width: 250px; height: 250px; background: rgba(255, 150, 180, 0.12); top: 60%; right: 10%; animation-delay: -5s; }
        .bokeh-circle:nth-child(3) { width: 200px; height: 200px; background: rgba(255, 80, 120, 0.1); bottom: 20%; left: 20%; animation-delay: -10s; }
        .bokeh-circle:nth-child(4) { width: 350px; height: 350px; background: rgba(255, 120, 160, 0.08); top: 30%; right: 25%; animation-delay: -15s; }

        @keyframes bokehFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(50px, -30px) scale(1.1); }
            50% { transform: translate(-30px, 50px) scale(0.95); }
            75% { transform: translate(40px, 20px) scale(1.05); }
        }

        .bg-particles { z-index: 4; }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: particleTwinkle 4s infinite ease-in-out;
        }

        @keyframes particleTwinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.5); }
        }

        .bg-falling { z-index: 5; pointer-events: none; }

        .falling-item {
            position: absolute;
            top: -60px;
            animation: gentleFall linear infinite;
            opacity: 0.6;
            filter: drop-shadow(0 0 10px rgba(255, 150, 180, 0.5));
        }

        @keyframes gentleFall {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 0; }
            5% { opacity: 0.6; }
            95% { opacity: 0.6; }
            100% { transform: translateY(110vh) rotate(360deg) translateX(30px); opacity: 0; }
        }

        .bg-texture {
            z-index: 6;
            opacity: 0.03;
            background-image: radial-gradient(circle at 1px 1px, white 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* ===== KONTENER ===== */
        
        .container {
            text-align: center;
            z-index: 100;
            padding: 55px 65px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.97) 0%, rgba(255, 252, 253, 0.98) 50%, rgba(255, 248, 250, 0.97) 100%);
            border-radius: 24px;
            box-shadow: 0 50px 100px rgba(0, 0, 0, 0.4), 0 20px 60px rgba(100, 30, 50, 0.3), 0 0 0 1px rgba(255, 200, 210, 0.5), inset 0 1px 0 rgba(255, 255, 255, 1), inset 0 -1px 0 rgba(200, 150, 160, 0.1);
            position: relative;
            max-width: 560px;
            width: 90%;
            animation: containerFloat 6s ease-in-out infinite, containerIn 1s ease-out;
        }

        @keyframes containerIn {
            0% { opacity: 0; transform: translateY(40px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes containerFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        .container::before {
            content: '';
            position: absolute;
            top: 12px; left: 12px; right: 12px; bottom: 12px;
            border: 1.5px solid rgba(200, 120, 140, 0.25);
            border-radius: 16px;
            pointer-events: none;
        }

        .container::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(135deg, rgba(255, 180, 200, 0.4), rgba(255, 150, 180, 0.2), rgba(255, 200, 220, 0.3));
            border-radius: 26px;
            z-index: -1;
            filter: blur(20px);
            opacity: 0.7;
            animation: glowPulse 4s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        .corner-decor {
            position: absolute;
            font-size: 32px;
            filter: drop-shadow(0 4px 8px rgba(150, 50, 80, 0.3));
            animation: cornerPulse 3s ease-in-out infinite;
        }

        .corner-decor.tl { top: -16px; left: -16px; }
        .corner-decor.tr { top: -16px; right: -16px; animation-delay: 0.75s; }
        .corner-decor.bl { bottom: -16px; left: -16px; animation-delay: 1.5s; }
        .corner-decor.br { bottom: -16px; right: -16px; animation-delay: 2.25s; }

        @keyframes cornerPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.15) rotate(5deg); }
        }

        .title { margin-bottom: 8px; }

        .title h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.4rem;
            font-weight: 700;
            color: #8b2942;
            letter-spacing: 2px;
            margin-bottom: 6px;
        }

        .title-hearts { color: #d64060; font-size: 1.4rem; letter-spacing: 8px; }

        .subtitle {
            font-size: 0.75rem;
            font-weight: 600;
            color: #b08090;
            letter-spacing: 5px;
            text-transform: uppercase;
            margin-top: 8px;
        }

        .separator {
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #d4a0b0, transparent);
            margin: 25px auto;
        }

        .question {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.65rem;
            font-weight: 600;
            color: #4a3040;
            line-height: 1.6;
            margin: 25px 0;
        }

        .question-heart {
            display: inline-block;
            color: #d64060;
            animation: heartBeat 1.2s ease-in-out infinite;
            margin-left: 5px;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            15% { transform: scale(1.25); }
            30% { transform: scale(1); }
            45% { transform: scale(1.2); }
            60% { transform: scale(1); }
        }

        /* ===== PRZYCISKI ===== */
        
        .buttons-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-top: 35px;
            position: relative;
            min-height: 60px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'Quicksand', sans-serif;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            letter-spacing: 1px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-width: 140px;
            text-align: center;
        }

        .btn-yes {
            background: linear-gradient(135deg, #a24857 0%, #8b2942 50%, #6d1f35 100%);
            color: #fff;
            box-shadow: 0 8px 30px rgba(139, 41, 66, 0.5), 0 4px 15px rgba(109, 31, 53, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 150, 180, 0.3);
        }

        .btn-yes:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(139, 41, 66, 0.6), 0 8px 20px rgba(109, 31, 53, 0.5), 0 0 20px rgba(255, 100, 130, 0.3);
        }

        .btn-no {
            background: linear-gradient(135deg, #5a4a50 0%, #4a3a42 50%, #3a2a32 100%);
            color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 200, 210, 0.2);
            width: 140px; min-width: 140px; max-width: 140px; height: 52px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: transform 0.3s ease, left 0.3s ease, box-shadow 0.3s ease;
        }

        .sad-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: sadIn 0.3s ease;
        }

        @keyframes sadIn { 0% { opacity: 0; } 100% { opacity: 1; } }

        .sad-emoji { font-size: 200px; animation: sadBounce 0.6s ease; }

        @keyframes sadBounce {
            0% { transform: scale(0) rotate(-20deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* ===== EKRAN SUKCESU ===== */
        
        .success-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }

        .success-bg-base, .success-bg-aurora, .success-bg-bokeh, .success-bg-particles, .success-bg-falling {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
        }

        .success-bg-base {
            background: 
                radial-gradient(ellipse at 10% 20%, rgba(120, 50, 80, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 80%, rgba(180, 80, 100, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(60, 20, 40, 0.2) 0%, transparent 70%),
                linear-gradient(180deg, #1a0a10 0%, #2d1520 30%, #3d1f2d 60%, #2a1018 100%);
            z-index: 1;
        }

        .success-bg-aurora {
            opacity: 0.4;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 100, 150, 0.1) 50%, transparent 100%);
            animation: auroraMove 15s ease-in-out infinite;
            z-index: 2;
        }

        .success-bg-bokeh { z-index: 3; }
        .success-bg-particles { z-index: 4; }
        .success-bg-falling { z-index: 5; pointer-events: none; }

        .success-card {
            text-align: center;
            padding: 50px 60px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.97) 0%, rgba(255, 252, 253, 0.98) 50%, rgba(255, 248, 250, 0.97) 100%);
            border-radius: 24px;
            box-shadow: 0 50px 100px rgba(0, 0, 0, 0.4), 0 20px 60px rgba(100, 30, 50, 0.3), 0 0 0 1px rgba(255, 200, 210, 0.5);
            z-index: 100;
            animation: cardPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 500px;
            width: 90%;
            position: relative;
        }

        .success-card::before {
            content: '';
            position: absolute;
            top: 12px; left: 12px; right: 12px; bottom: 12px;
            border: 1.5px solid rgba(200, 120, 140, 0.25);
            border-radius: 16px;
            pointer-events: none;
        }

        @keyframes cardPop {
            0% { opacity: 0; transform: scale(0.8) translateY(30px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .success-card h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.3rem;
            font-weight: 700;
            color: #8b2942;
            margin-bottom: 10px;
        }

        .success-card p {
            font-family: 'Quicksand', sans-serif;
            font-size: 1.2rem;
            color: #6a4a55;
            margin-bottom: 30px;
        }

        /* PRZYCISK MAGIC - IDENTYCZNY JAK TAK */
        .btn-magic {
            padding: 18px 45px;
            font-size: 1.15rem;
            font-weight: 700;
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #a24857 0%, #8b2942 50%, #6d1f35 100%);
            color: #fff;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(139, 41, 66, 0.5), 0 4px 15px rgba(109, 31, 53, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 150, 180, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            animation: magicGlow 2s ease-in-out infinite;
        }

        @keyframes magicGlow {
            0%, 100% { box-shadow: 0 8px 30px rgba(139, 41, 66, 0.5), 0 4px 15px rgba(109, 31, 53, 0.4); }
            50% { box-shadow: 0 12px 40px rgba(139, 41, 66, 0.7), 0 8px 25px rgba(109, 31, 53, 0.5), 0 0 30px rgba(255, 100, 130, 0.3); }
        }

        .btn-magic:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(139, 41, 66, 0.6), 0 8px 20px rgba(109, 31, 53, 0.5), 0 0 20px rgba(255, 100, 130, 0.3);
        }

        /* ===== ANIMACJA - CANVAS ===== */
        
        .cinema-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10000;
            background: #000;
        }

        #cinemaCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .cinema-end {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 100;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .cinema-end h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3rem;
            font-weight: 600;
            color: white;
            letter-spacing: 4px;
            line-height: 1.6;
            text-shadow: 0 0 40px rgba(255, 255, 255, 0.3);
        }

        .cinema-end .final-heart {
            font-size: 60px;
            margin-top: 30px;
            display: block;
            animation: finalBeat 1s ease-in-out infinite;
        }

        @keyframes finalBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Responsywno≈õƒá */
        @media (max-width: 600px) {
            .container { padding: 40px 25px; margin: 15px; }
            .title h1 { font-size: 1.8rem; }
            .question { font-size: 1.3rem; }
            .btn { min-width: 110px; padding: 12px 25px; font-size: 1rem; }
            .btn-no { width: 110px; min-width: 110px; max-width: 110px; height: 46px; }
            .buttons-container { gap: 15px; }
            .corner-decor { font-size: 24px; }
            .success-card { padding: 35px 25px; }
            .success-card h2 { font-size: 1.7rem; }
            .cinema-end h1 { font-size: 1.5rem; letter-spacing: 2px; }
            .cinema-end .final-heart { font-size: 40px; }
        }
    </style>
</head>
<body>
    <!-- T≈ÅO -->
    <div class="bg-layer bg-base"></div>
    <div class="bg-layer bg-aurora"></div>
    <div class="bg-layer bg-bokeh" id="bokehLayer">
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
        <div class="bokeh-circle"></div>
    </div>
    <div class="bg-layer bg-particles" id="particlesLayer"></div>
    <div class="bg-layer bg-falling" id="fallingLayer"></div>
    <div class="bg-layer bg-texture"></div>

    <!-- KONTENER -->
    <div class="container" id="mainContainer">
        <span class="corner-decor tl">üåπ</span>
        <span class="corner-decor tr">üåπ</span>
        <span class="corner-decor bl">üíê</span>
        <span class="corner-decor br">üíê</span>

        <div class="title">
            <h1>Dla Mojej Jedynej</h1>
            <div class="title-hearts">üíï üíï üíï</div>
            <p class="subtitle">Walentynki 2026</p>
        </div>
        
        <div class="separator"></div>
        
        <p class="question">
            Czy zostaniesz mojƒÖ WalentynkƒÖ? <span class="question-heart">‚ù§Ô∏è</span>
        </p>
        
        <div class="buttons-container" id="btnContainer">
            <button class="btn btn-yes" id="yesBtn">TAK üíñ</button>
            <button class="btn btn-no" id="noBtn">NIE üíî</button>
        </div>
    </div>

    <script>
        // ===== T≈ÅO =====
        function createParticles() {
            const container = document.getElementById('particlesLayer');
            for (let i = 0; i < 80; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.top = Math.random() * 100 + '%';
                p.style.width = (1 + Math.random() * 2.5) + 'px';
                p.style.height = p.style.width;
                p.style.animationDelay = Math.random() * 4 + 's';
                p.style.animationDuration = (3 + Math.random() * 3) + 's';
                container.appendChild(p);
            }
        }
        createParticles();

        function createFallingElements() {
            const container = document.getElementById('fallingLayer');
            const items = ['üíï', 'üå∏', 'üíó', '‚ú®', 'üåπ', 'üíñ', 'ü¶ã'];
            
            function addFalling() {
                const el = document.createElement('div');
                el.className = 'falling-item';
                el.textContent = items[Math.floor(Math.random() * items.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.fontSize = (18 + Math.random() * 20) + 'px';
                el.style.animationDuration = (8 + Math.random() * 8) + 's';
                el.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(el);
                setTimeout(() => el.remove(), 18000);
            }
            
            for (let i = 0; i < 12; i++) setTimeout(addFalling, i * 300);
            setInterval(addFalling, 1500);
        }
        createFallingElements();

        // ===== PRZYCISK NIE =====
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const mainContainer = document.getElementById('mainContainer');
        
        let isMobile = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        let escapeCount = 0;
        
        function getContainerBounds() {
            const rect = mainContainer.getBoundingClientRect();
            return {
                left: 20,
                right: rect.width - noBtn.offsetWidth - 20,
                top: 150,
                bottom: rect.height - noBtn.offsetHeight - 20
            };
        }
        
        function escapeInContainer() {
            escapeCount++;
            const bounds = getContainerBounds();
            const newX = bounds.left + Math.random() * (bounds.right - bounds.left);
            const newY = bounds.top + Math.random() * (bounds.bottom - bounds.top);
            
            noBtn.style.position = 'absolute';
            noBtn.style.left = newX + 'px';
            noBtn.style.top = newY + 'px';
            noBtn.style.transition = 'left 0.35s ease-out, top 0.35s ease-out';
            
            const texts = ['NIE üíî', 'Nie! üôà', 'Haha! üòú', 'Z≈Çap mnie! üèÉ', 'Niemo≈ºliwe! ‚ú®', 'Wybierz TAK! üíï'];
            noBtn.textContent = texts[Math.min(escapeCount - 1, texts.length - 1)];
        }
        
        if (!isMobile) noBtn.addEventListener('mouseenter', escapeInContainer);
        if (isMobile) noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); escapeInContainer(); });
        
        noBtn.addEventListener('click', (e) => {
            if (isMobile) return;
            const overlay = document.createElement('div');
            overlay.className = 'sad-overlay';
            overlay.innerHTML = '<div class="sad-emoji">üò¢</div>';
            document.body.appendChild(overlay);
            setTimeout(() => overlay.remove(), 1800);
        });

        // ===== PRZYCISK TAK =====
        yesBtn.addEventListener('click', showSuccessScreen);
        
        function showSuccessScreen() {
            mainContainer.style.transition = 'opacity 0.5s, transform 0.5s';
            mainContainer.style.opacity = '0';
            mainContainer.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                mainContainer.style.display = 'none';
                
                const successScreen = document.createElement('div');
                successScreen.className = 'success-screen';
                successScreen.id = 'successScreen';
                successScreen.innerHTML = `
                    <div class="success-bg-base"></div>
                    <div class="success-bg-aurora"></div>
                    <div class="success-bg-bokeh" id="successBokeh"></div>
                    <div class="success-bg-particles" id="successParticles"></div>
                    <div class="success-bg-falling" id="successFalling"></div>
                    <div class="success-card">
                        <h2>DOSKONA≈ÅY WYB√ìR WIKUSIA üíñ</h2>
                        <p>Kocham Ciƒô najbardziej na ≈õwiecie! üíï</p>
                        <button class="btn-magic" id="magicBtn">‚ú® To teraz czary ‚ú®</button>
                    </div>
                `;
                document.body.appendChild(successScreen);
                
                // Bokeh
                const bokehContainer = document.getElementById('successBokeh');
                for (let i = 0; i < 4; i++) {
                    const circle = document.createElement('div');
                    circle.className = 'bokeh-circle';
                    bokehContainer.appendChild(circle);
                }
                
                // Particles
                const particlesContainer = document.getElementById('successParticles');
                for (let i = 0; i < 60; i++) {
                    const p = document.createElement('div');
                    p.className = 'particle';
                    p.style.left = Math.random() * 100 + '%';
                    p.style.top = Math.random() * 100 + '%';
                    p.style.width = (1 + Math.random() * 2.5) + 'px';
                    p.style.height = p.style.width;
                    p.style.animationDelay = Math.random() * 4 + 's';
                    particlesContainer.appendChild(p);
                }
                
                // Falling
                const fallingContainer = document.getElementById('successFalling');
                const items = ['üíï', 'üå∏', 'üíó', '‚ú®', 'üåπ', 'üíñ', '‚ù§Ô∏è'];
                
                function addSuccessFalling() {
                    const el = document.createElement('div');
                    el.className = 'falling-item';
                    el.textContent = items[Math.floor(Math.random() * items.length)];
                    el.style.left = Math.random() * 100 + '%';
                    el.style.fontSize = (20 + Math.random() * 25) + 'px';
                    el.style.animationDuration = (6 + Math.random() * 6) + 's';
                    fallingContainer.appendChild(el);
                    setTimeout(() => el.remove(), 14000);
                }
                
                for (let i = 0; i < 15; i++) setTimeout(addSuccessFalling, i * 200);
                const fallingInterval = setInterval(addSuccessFalling, 800);
                
                document.getElementById('magicBtn').addEventListener('click', () => {
                    clearInterval(fallingInterval);
                    startCinema();
                });
                
            }, 500);
        }

        // ===== PROFESJONALNA ANIMACJA CANVAS =====
        function startCinema() {
            document.getElementById('successScreen').remove();
            
            const cinema = document.createElement('div');
            cinema.className = 'cinema-container';
            cinema.innerHTML = `
                <canvas id="cinemaCanvas"></canvas>
                <div class="cinema-end" id="cinemaEnd">
                    <h1>DZIƒòKUJƒò ZA KOLEJNY<br>WSPANIA≈ÅY ROK</h1>
                    <span class="final-heart">üíï</span>
                </div>
            `;
            document.body.appendChild(cinema);
            
            const canvas = document.getElementById('cinemaCanvas');
            const ctx = canvas.getContext('2d');
            
            // Retina support
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            ctx.scale(dpr, dpr);
            
            const W = window.innerWidth;
            const H = window.innerHeight;
            
            // ===== ANIMATION STATE =====
            let time = 0;
            let cameraY = 0;
            const SCENE_HEIGHT = H * 4;
            
            // Stars
            const stars = [];
            for (let i = 0; i < 300; i++) {
                stars.push({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    r: Math.random() * 2 + 0.5,
                    twinkle: Math.random() * Math.PI * 2
                });
            }
            
            // Clouds
            const clouds = [];
            for (let i = 0; i < 8; i++) {
                clouds.push({
                    x: Math.random() * W,
                    y: H * 1.5 + Math.random() * H * 0.5,
                    w: 100 + Math.random() * 150,
                    h: 40 + Math.random() * 30,
                    speed: 0.2 + Math.random() * 0.3
                });
            }
            
            // Trees
            const trees = [
                { x: W * 0.08, scale: 1 },
                { x: W * 0.18, scale: 0.8 },
                { x: W * 0.82, scale: 1.1 },
                { x: W * 0.92, scale: 0.9 }
            ];
            
            // Flowers
            const flowers = [];
            for (let i = 0; i < 30; i++) {
                flowers.push({
                    x: Math.random() * W,
                    color: ['#ff69b4', '#ff6b6b', '#ffd54f', '#ba68c8', '#4fc3f7'][Math.floor(Math.random() * 5)],
                    phase: Math.random() * Math.PI * 2,
                    size: 8 + Math.random() * 6
                });
            }
            
            // Hearts particles
            const hearts = [];
            
            // Characters state
            const girl = {
                x: W * 0.35,
                y: -200,
                targetY: H * 0.65,
                rotation: 0,
                armAngle: 0,
                legAngle: 0,
                visible: false,
                dusting: false,
                dustPhase: 0,
                hit: false
            };
            
            const boy = {
                x: W * 1.2,
                targetX: W * 0.65,
                y: H * 0.65,
                walkPhase: 0,
                armAngle: 0,
                legAngle: 0,
                visible: false,
                hit: false
            };
            
            const cupid = {
                x: W * 0.5,
                y: -100,
                targetY: H * 0.2,
                wingPhase: 0,
                visible: false,
                shooting: false,
                shotsFired: 0
            };
            
            const arrows = [];
            
            let showHug = false;
            let fadeAlpha = 0;
            let showEnd = false;
            
            // ===== DRAWING FUNCTIONS =====
            
            function drawStar(x, y, r, alpha) {
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.fill();
                
                // Glow
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, r * 3);
                gradient.addColorStop(0, `rgba(255, 255, 255, ${alpha * 0.5})`);
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(x, y, r * 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawMoon(x, y, r) {
                // Main moon
                const gradient = ctx.createRadialGradient(x - r * 0.3, y - r * 0.3, 0, x, y, r);
                gradient.addColorStop(0, '#fffef0');
                gradient.addColorStop(0.5, '#e8e4d4');
                gradient.addColorStop(1, '#c0b8a0');
                
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Craters
                ctx.fillStyle = 'rgba(150, 140, 120, 0.3)';
                ctx.beginPath();
                ctx.arc(x + r * 0.2, y - r * 0.2, r * 0.15, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(x - r * 0.3, y + r * 0.3, r * 0.12, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(x + r * 0.4, y + r * 0.2, r * 0.08, 0, Math.PI * 2);
                ctx.fill();
                
                // Glow
                const glowGradient = ctx.createRadialGradient(x, y, r, x, y, r * 2);
                glowGradient.addColorStop(0, 'rgba(255, 255, 200, 0.3)');
                glowGradient.addColorStop(1, 'transparent');
                ctx.fillStyle = glowGradient;
                ctx.beginPath();
                ctx.arc(x, y, r * 2, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawSun(x, y, r) {
                // Rays
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2 + time * 0.001;
                    const rayLength = r * 1.5 + Math.sin(time * 0.003 + i) * r * 0.3;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(
                        x + Math.cos(angle) * rayLength,
                        y + Math.sin(angle) * rayLength
                    );
                    ctx.strokeStyle = 'rgba(255, 200, 50, 0.3)';
                    ctx.lineWidth = r * 0.3;
                    ctx.stroke();
                }
                
                // Main sun
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, r);
                gradient.addColorStop(0, '#fff9c4');
                gradient.addColorStop(0.3, '#ffeb3b');
                gradient.addColorStop(0.7, '#ff9800');
                gradient.addColorStop(1, '#ff5722');
                
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Glow
                const glowGradient = ctx.createRadialGradient(x, y, r, x, y, r * 3);
                glowGradient.addColorStop(0, 'rgba(255, 235, 59, 0.5)');
                glowGradient.addColorStop(0.5, 'rgba(255, 152, 0, 0.2)');
                glowGradient.addColorStop(1, 'transparent');
                ctx.fillStyle = glowGradient;
                ctx.beginPath();
                ctx.arc(x, y, r * 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawCloud(x, y, w, h) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                ctx.beginPath();
                ctx.ellipse(x, y, w * 0.5, h * 0.5, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(x - w * 0.3, y + h * 0.1, w * 0.35, h * 0.4, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(x + w * 0.3, y + h * 0.1, w * 0.4, h * 0.45, 0, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawTree(x, baseY, scale) {
                const trunkW = 20 * scale;
                const trunkH = 80 * scale;
                
                // Trunk
                const trunkGrad = ctx.createLinearGradient(x - trunkW/2, 0, x + trunkW/2, 0);
                trunkGrad.addColorStop(0, '#5d4037');
                trunkGrad.addColorStop(0.5, '#8d6e63');
                trunkGrad.addColorStop(1, '#5d4037');
                
                ctx.fillStyle = trunkGrad;
                ctx.fillRect(x - trunkW/2, baseY - trunkH, trunkW, trunkH);
                
                // Leaves layers
                const leafColors = ['#388e3c', '#43a047', '#4caf50'];
                const layers = [
                    { y: baseY - trunkH - 20 * scale, r: 50 * scale },
                    { y: baseY - trunkH - 55 * scale, r: 40 * scale },
                    { y: baseY - trunkH - 85 * scale, r: 30 * scale }
                ];
                
                layers.forEach((layer, i) => {
                    const gradient = ctx.createRadialGradient(
                        x - layer.r * 0.3, layer.y - layer.r * 0.3, 0,
                        x, layer.y, layer.r
                    );
                    gradient.addColorStop(0, '#66bb6a');
                    gradient.addColorStop(0.5, leafColors[i]);
                    gradient.addColorStop(1, '#2e7d32');
                    
                    ctx.beginPath();
                    ctx.arc(x, layer.y, layer.r, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                });
            }
            
            function drawFlower(x, baseY, color, size, phase) {
                const sway = Math.sin(time * 0.002 + phase) * 5;
                
                // Stem
                ctx.strokeStyle = '#4caf50';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(x, baseY);
                ctx.quadraticCurveTo(x + sway, baseY - size * 2, x + sway, baseY - size * 3);
                ctx.stroke();
                
                // Petals
                const petalCount = 6;
                for (let i = 0; i < petalCount; i++) {
                    const angle = (i / petalCount) * Math.PI * 2;
                    ctx.beginPath();
                    ctx.ellipse(
                        x + sway + Math.cos(angle) * size * 0.5,
                        baseY - size * 3 + Math.sin(angle) * size * 0.5,
                        size * 0.4, size * 0.6,
                        angle, 0, Math.PI * 2
                    );
                    ctx.fillStyle = color;
                    ctx.fill();
                }
                
                // Center
                ctx.beginPath();
                ctx.arc(x + sway, baseY - size * 3, size * 0.3, 0, Math.PI * 2);
                ctx.fillStyle = '#ffd54f';
                ctx.fill();
            }
            
            function drawPerson(x, y, isGirl, state) {
                ctx.save();
                ctx.translate(x, y);
                
                if (state.rotation) {
                    ctx.rotate(state.rotation);
                }
                
                const scale = 1;
                const headR = 25 * scale;
                const bodyH = 50 * scale;
                const bodyW = 35 * scale;
                const legH = 45 * scale;
                const armH = 40 * scale;
                
                // Shadow
                ctx.beginPath();
                ctx.ellipse(0, legH + 5, bodyW * 0.8, 8, 0, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fill();
                
                // Legs
                const legAngle = state.legAngle || 0;
                ctx.save();
                ctx.translate(-bodyW * 0.15, bodyH * 0.4);
                ctx.rotate(Math.sin(legAngle) * 0.3);
                ctx.fillStyle = isGirl ? '#5c6bc0' : '#37474f';
                ctx.beginPath();
                ctx.roundRect(-6, 0, 12, legH, 6);
                ctx.fill();
                // Shoe
                ctx.fillStyle = isGirl ? '#e91e63' : '#212121';
                ctx.beginPath();
                ctx.ellipse(0, legH, 10, 6, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                ctx.save();
                ctx.translate(bodyW * 0.15, bodyH * 0.4);
                ctx.rotate(-Math.sin(legAngle) * 0.3);
                ctx.fillStyle = isGirl ? '#5c6bc0' : '#37474f';
                ctx.beginPath();
                ctx.roundRect(-6, 0, 12, legH, 6);
                ctx.fill();
                // Shoe
                ctx.fillStyle = isGirl ? '#e91e63' : '#212121';
                ctx.beginPath();
                ctx.ellipse(0, legH, 10, 6, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // Body
                const bodyGrad = ctx.createLinearGradient(-bodyW/2, -bodyH/2, bodyW/2, bodyH/2);
                if (isGirl) {
                    bodyGrad.addColorStop(0, '#f48fb1');
                    bodyGrad.addColorStop(1, '#ec407a');
                } else {
                    bodyGrad.addColorStop(0, '#64b5f6');
                    bodyGrad.addColorStop(1, '#1e88e5');
                }
                
                ctx.beginPath();
                if (isGirl) {
                    // Dress shape
                    ctx.moveTo(-bodyW * 0.4, -bodyH * 0.5);
                    ctx.quadraticCurveTo(-bodyW * 0.5, bodyH * 0.2, -bodyW * 0.6, bodyH * 0.5);
                    ctx.lineTo(bodyW * 0.6, bodyH * 0.5);
                    ctx.quadraticCurveTo(bodyW * 0.5, bodyH * 0.2, bodyW * 0.4, -bodyH * 0.5);
                    ctx.closePath();
                } else {
                    ctx.roundRect(-bodyW/2, -bodyH/2, bodyW, bodyH, 10);
                }
                ctx.fillStyle = bodyGrad;
                ctx.fill();
                
                // Arms
                const armAngle = state.armAngle || 0;
                const dustOffset = state.dusting ? Math.sin(state.dustPhase * 10) * 0.5 : 0;
                
                // Left arm
                ctx.save();
                ctx.translate(-bodyW * 0.5, -bodyH * 0.3);
                ctx.rotate(-0.3 + Math.sin(armAngle) * 0.2 + dustOffset);
                ctx.fillStyle = '#fdbf91';
                ctx.beginPath();
                ctx.roundRect(-5, 0, 10, armH, 5);
                ctx.fill();
                // Hand
                ctx.beginPath();
                ctx.arc(0, armH, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // Right arm
                ctx.save();
                ctx.translate(bodyW * 0.5, -bodyH * 0.3);
                ctx.rotate(0.3 - Math.sin(armAngle) * 0.2 - dustOffset);
                ctx.fillStyle = '#fdbf91';
                ctx.beginPath();
                ctx.roundRect(-5, 0, 10, armH, 5);
                ctx.fill();
                // Hand
                ctx.beginPath();
                ctx.arc(0, armH, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // Neck
                ctx.fillStyle = '#fdbf91';
                ctx.beginPath();
                ctx.roundRect(-8, -bodyH/2 - 10, 16, 15, 3);
                ctx.fill();
                
                // Head
                const headGrad = ctx.createRadialGradient(-headR * 0.3, -bodyH/2 - headR - headR * 0.3, 0, 0, -bodyH/2 - headR, headR);
                headGrad.addColorStop(0, '#ffecd2');
                headGrad.addColorStop(1, '#e8a676');
                
                ctx.beginPath();
                ctx.arc(0, -bodyH/2 - headR, headR, 0, Math.PI * 2);
                ctx.fillStyle = headGrad;
                ctx.fill();
                
                // Hair
                if (isGirl) {
                    // Long black hair
                    ctx.fillStyle = '#1a1a1a';
                    ctx.beginPath();
                    ctx.arc(0, -bodyH/2 - headR - 5, headR + 8, Math.PI, 0, true);
                    ctx.fill();
                    
                    // Side hair
                    ctx.beginPath();
                    ctx.ellipse(-headR - 5, -bodyH/2 - headR + 10, 12, 50, -0.2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(headR + 5, -bodyH/2 - headR + 10, 12, 50, 0.2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Bangs
                    ctx.beginPath();
                    ctx.arc(0, -bodyH/2 - headR - 5, headR + 3, Math.PI * 1.2, Math.PI * 1.8);
                    ctx.fill();
                } else {
                    // Short dark blonde hair
                    const hairGrad = ctx.createLinearGradient(0, -bodyH/2 - headR * 2, 0, -bodyH/2 - headR);
                    hairGrad.addColorStop(0, '#a08060');
                    hairGrad.addColorStop(1, '#8b7355');
                    
                    ctx.fillStyle = hairGrad;
                    ctx.beginPath();
                    ctx.arc(0, -bodyH/2 - headR - 3, headR + 5, Math.PI, 0, true);
                    ctx.fill();
                }
                
                // Face
                const faceY = -bodyH/2 - headR;
                
                // Eyes
                ctx.fillStyle = '#3e2723';
                ctx.beginPath();
                ctx.ellipse(-8, faceY - 3, 4, 5, 0, 0, Math.PI * 2);
                ctx.ellipse(8, faceY - 3, 4, 5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Eye shine
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(-6, faceY - 5, 2, 0, Math.PI * 2);
                ctx.arc(10, faceY - 5, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Blush
                if (isGirl || state.hit) {
                    ctx.fillStyle = 'rgba(255, 138, 128, 0.4)';
                    ctx.beginPath();
                    ctx.ellipse(-15, faceY + 5, 8, 4, 0, 0, Math.PI * 2);
                    ctx.ellipse(15, faceY + 5, 8, 4, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Mouth
                ctx.fillStyle = '#e57373';
                ctx.beginPath();
                ctx.arc(0, faceY + 12, 5, 0, Math.PI);
                ctx.fill();
                
                // Eyelashes for girl
                if (isGirl) {
                    ctx.strokeStyle = '#1a1a1a';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(-12, faceY - 8);
                    ctx.lineTo(-14, faceY - 12);
                    ctx.moveTo(-8, faceY - 9);
                    ctx.lineTo(-8, faceY - 13);
                    ctx.moveTo(-4, faceY - 8);
                    ctx.lineTo(-2, faceY - 12);
                    ctx.moveTo(4, faceY - 8);
                    ctx.lineTo(2, faceY - 12);
                    ctx.moveTo(8, faceY - 9);
                    ctx.lineTo(8, faceY - 13);
                    ctx.moveTo(12, faceY - 8);
                    ctx.lineTo(14, faceY - 12);
                    ctx.stroke();
                }
                
                // Hit heart
                if (state.hit) {
                    ctx.font = '30px Arial';
                    ctx.fillText('üíò', -15, bodyH * 0.7);
                }
                
                ctx.restore();
            }
            
            function drawCupid(x, y, state) {
                ctx.save();
                ctx.translate(x, y);
                
                const scale = 0.8;
                const headR = 22 * scale;
                const bodyH = 30 * scale;
                
                // Wings
                const wingPhase = state.wingPhase;
                const wingAngle = Math.sin(wingPhase) * 0.3;
                
                // Left wing
                ctx.save();
                ctx.translate(-25 * scale, 10);
                ctx.rotate(-0.5 + wingAngle);
                const wingGrad = ctx.createLinearGradient(0, 0, -50, -30);
                wingGrad.addColorStop(0, 'rgba(255, 255, 255, 0.95)');
                wingGrad.addColorStop(1, 'rgba(255, 220, 230, 0.7)');
                ctx.fillStyle = wingGrad;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(-60 * scale, -40 * scale, -40 * scale, 20 * scale);
                ctx.quadraticCurveTo(-20 * scale, 40 * scale, 0, 20 * scale);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'rgba(255, 200, 220, 0.5)';
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.restore();
                
                // Right wing
                ctx.save();
                ctx.translate(25 * scale, 10);
                ctx.rotate(0.5 - wingAngle);
                ctx.fillStyle = wingGrad;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(60 * scale, -40 * scale, 40 * scale, 20 * scale);
                ctx.quadraticCurveTo(20 * scale, 40 * scale, 0, 20 * scale);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'rgba(255, 200, 220, 0.5)';
                ctx.stroke();
                ctx.restore();
                
                // Body (white cloth)
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.ellipse(0, bodyH * 0.3, 18 * scale, bodyH * 0.7, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = 'rgba(255, 220, 230, 0.5)';
                ctx.fill();
                
                // Head
                const headGrad = ctx.createRadialGradient(-5, -bodyH * 0.5 - headR * 0.3, 0, 0, -bodyH * 0.5, headR);
                headGrad.addColorStop(0, '#ffecd2');
                headGrad.addColorStop(1, '#fcb69f');
                ctx.beginPath();
                ctx.arc(0, -bodyH * 0.5, headR, 0, Math.PI * 2);
                ctx.fillStyle = headGrad;
                ctx.fill();
                
                // Golden curly hair
                ctx.fillStyle = '#ffd54f';
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI + Math.PI;
                    const cx = Math.cos(angle) * (headR + 5);
                    const cy = -bodyH * 0.5 + Math.sin(angle) * (headR + 5) - 5;
                    ctx.beginPath();
                    ctx.arc(cx, cy, 8 * scale, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Face
                ctx.fillStyle = '#3e2723';
                ctx.beginPath();
                ctx.arc(-6, -bodyH * 0.5 - 2, 3, 0, Math.PI * 2);
                ctx.arc(6, -bodyH * 0.5 - 2, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#e57373';
                ctx.beginPath();
                ctx.arc(0, -bodyH * 0.5 + 8, 4, 0, Math.PI);
                ctx.fill();
                
                // Bow and arrow
                ctx.save();
                ctx.translate(-35 * scale, 5);
                ctx.rotate(-0.5);
                
                // Bow
                ctx.strokeStyle = '#8b4513';
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.arc(0, 0, 30 * scale, -Math.PI * 0.4, Math.PI * 0.4);
                ctx.stroke();
                
                // String
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(
                    Math.cos(-Math.PI * 0.4) * 30 * scale,
                    Math.sin(-Math.PI * 0.4) * 30 * scale
                );
                ctx.lineTo(
                    Math.cos(Math.PI * 0.4) * 30 * scale,
                    Math.sin(Math.PI * 0.4) * 30 * scale
                );
                ctx.stroke();
                
                ctx.restore();
                
                ctx.restore();
            }
            
            function drawArrow(arrow) {
                ctx.save();
                ctx.translate(arrow.x, arrow.y);
                ctx.rotate(arrow.angle);
                
                // Shaft
                ctx.fillStyle = '#8b4513';
                ctx.beginPath();
                ctx.roundRect(-30, -2, 60, 4, 2);
                ctx.fill();
                
                // Heart head
                ctx.fillStyle = '#ff69b4';
                ctx.beginPath();
                ctx.moveTo(30, 0);
                ctx.bezierCurveTo(30, -8, 40, -12, 45, -6);
                ctx.bezierCurveTo(50, 0, 45, 8, 30, 15);
                ctx.bezierCurveTo(15, 8, 10, 0, 15, -6);
                ctx.bezierCurveTo(20, -12, 30, -8, 30, 0);
                ctx.fill();
                
                // Feathers
                ctx.fillStyle = '#ff1493';
                ctx.beginPath();
                ctx.moveTo(-30, 0);
                ctx.lineTo(-45, -10);
                ctx.lineTo(-35, 0);
                ctx.lineTo(-45, 10);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            }
            
            function drawHeart(x, y, size, alpha) {
                ctx.save();
                ctx.translate(x, y);
                ctx.scale(size, size);
                ctx.globalAlpha = alpha;
                
                ctx.fillStyle = '#ff69b4';
                ctx.beginPath();
                ctx.moveTo(0, 5);
                ctx.bezierCurveTo(-15, -10, -25, 5, 0, 20);
                ctx.bezierCurveTo(25, 5, 15, -10, 0, 5);
                ctx.fill();
                
                // Shine
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.beginPath();
                ctx.arc(-5, 0, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
            
            function drawHugCouple(x, y) {
                ctx.save();
                ctx.translate(x, y);
                
                // Combined silhouette hugging
                const headR = 25;
                
                // Girl's hair behind
                ctx.fillStyle = '#1a1a1a';
                ctx.beginPath();
                ctx.ellipse(-20, -60, 35, 45, -0.2, 0, Math.PI * 2);
                ctx.fill();
                
                // Bodies together
                const bodyGrad = ctx.createLinearGradient(-40, 0, 40, 0);
                bodyGrad.addColorStop(0, '#f48fb1');
                bodyGrad.addColorStop(0.5, '#ba68c8');
                bodyGrad.addColorStop(1, '#64b5f6');
                
                ctx.fillStyle = bodyGrad;
                ctx.beginPath();
                ctx.ellipse(0, 20, 45, 55, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // Heads
                ctx.fillStyle = '#fdbf91';
                ctx.beginPath();
                ctx.arc(-15, -55, headR, 0, Math.PI * 2);
                ctx.arc(15, -55, headR, 0, Math.PI * 2);
                ctx.fill();
                
                // Girl's hair front
                ctx.fillStyle = '#1a1a1a';
                ctx.beginPath();
                ctx.arc(-15, -60, headR + 5, Math.PI, 0, true);
                ctx.fill();
                
                // Boy's hair
                ctx.fillStyle = '#8b7355';
                ctx.beginPath();
                ctx.arc(15, -60, headR + 3, Math.PI, 0, true);
                ctx.fill();
                
                // Arms hugging
                ctx.fillStyle = '#fdbf91';
                ctx.beginPath();
                ctx.ellipse(-35, 10, 10, 30, -0.3, 0, Math.PI * 2);
                ctx.ellipse(35, 10, 10, 30, 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // Hearts around
                const heartTime = time * 0.003;
                for (let i = 0; i < 5; i++) {
                    const angle = heartTime + (i / 5) * Math.PI * 2;
                    const radius = 80 + Math.sin(time * 0.005 + i) * 10;
                    const hx = Math.cos(angle) * radius;
                    const hy = Math.sin(angle) * radius - 20;
                    drawHeart(hx, hy, 0.5 + Math.sin(time * 0.01 + i) * 0.2, 0.7);
                }
                
                ctx.restore();
            }
            
            // ===== MAIN ANIMATION LOOP =====
            function animate() {
                time++;
                ctx.clearRect(0, 0, W, H);
                
                // Camera movement
                const cameraProgress = Math.min(1, time / 600);
                cameraY = easeInOutCubic(cameraProgress) * (SCENE_HEIGHT - H);
                
                // ===== DRAW SCENE =====
                
                // Space background (0 - H)
                if (cameraY < H) {
                    const spaceAlpha = 1 - Math.max(0, (cameraY - H * 0.5) / (H * 0.5));
                    ctx.globalAlpha = spaceAlpha;
                    
                    // Deep space gradient
                    const spaceGrad = ctx.createLinearGradient(0, -cameraY, 0, H - cameraY);
                    spaceGrad.addColorStop(0, '#000000');
                    spaceGrad.addColorStop(0.3, '#0a0015');
                    spaceGrad.addColorStop(0.6, '#150025');
                    spaceGrad.addColorStop(1, '#1a0030');
                    ctx.fillStyle = spaceGrad;
                    ctx.fillRect(0, 0, W, H);
                    
                    // Stars
                    stars.forEach(star => {
                        const sy = star.y - cameraY * 0.3;
                        if (sy > -10 && sy < H + 10) {
                            const twinkle = 0.5 + Math.sin(time * 0.05 + star.twinkle) * 0.5;
                            drawStar(star.x, sy, star.r, twinkle * spaceAlpha);
                        }
                    });
                    
                    // Moon
                    drawMoon(W * 0.7, H * 0.15 - cameraY * 0.2, 50);
                    
                    ctx.globalAlpha = 1;
                }
                
                // Atmosphere (H - 2H)
                if (cameraY > H * 0.5 && cameraY < H * 2.5) {
                    const atmoY = H - (cameraY - H);
                    
                    const atmoGrad = ctx.createLinearGradient(0, atmoY, 0, atmoY + H);
                    atmoGrad.addColorStop(0, '#1a0030');
                    atmoGrad.addColorStop(0.2, '#4a2c6a');
                    atmoGrad.addColorStop(0.4, '#8660a0');
                    atmoGrad.addColorStop(0.6, '#ff9a9e');
                    atmoGrad.addColorStop(0.8, '#fecfef');
                    atmoGrad.addColorStop(1, '#87CEEB');
                    
                    ctx.fillStyle = atmoGrad;
                    ctx.fillRect(0, Math.max(0, atmoY), W, H);
                    
                    // Clouds
                    clouds.forEach(cloud => {
                        const cy = cloud.y - cameraY;
                        if (cy > -100 && cy < H + 100) {
                            cloud.x += cloud.speed;
                            if (cloud.x > W + 100) cloud.x = -100;
                            drawCloud(cloud.x, cy, cloud.w, cloud.h);
                        }
                    });
                }
                
                // Sky (2H - 3H)
                if (cameraY > H * 1.5) {
                    const skyY = H * 2 - cameraY;
                    
                    const skyGrad = ctx.createLinearGradient(0, skyY, 0, skyY + H);
                    skyGrad.addColorStop(0, '#87CEEB');
                    skyGrad.addColorStop(0.5, '#b0e0f0');
                    skyGrad.addColorStop(1, '#c8ebf5');
                    
                    ctx.fillStyle = skyGrad;
                    ctx.fillRect(0, Math.max(0, skyY), W, Math.min(H, H - skyY));
                    
                    // Sun
                    if (skyY < H) {
                        drawSun(W * 0.8, skyY + H * 0.2, 60);
                    }
                }
                
                // Ground (3H - 4H)
                if (cameraY > H * 2) {
                    const groundY = H * 3 - cameraY;
                    
                    // Sky above ground
                    if (groundY > 0) {
                        ctx.fillStyle = '#c8ebf5';
                        ctx.fillRect(0, 0, W, groundY);
                        drawSun(W * 0.8, groundY * 0.3, 60);
                    }
                    
                    // Grass
                    const grassGrad = ctx.createLinearGradient(0, groundY, 0, H);
                    grassGrad.addColorStop(0, '#90c695');
                    grassGrad.addColorStop(0.2, '#68b36b');
                    grassGrad.addColorStop(0.5, '#4caf50');
                    grassGrad.addColorStop(1, '#2e7d32');
                    
                    ctx.fillStyle = grassGrad;
                    ctx.fillRect(0, Math.max(0, groundY), W, H - Math.max(0, groundY));
                    
                    // Trees
                    if (groundY < H) {
                        trees.forEach(tree => {
                            drawTree(tree.x, groundY + 20, tree.scale);
                        });
                    }
                    
                    // Flowers
                    if (groundY < H) {
                        flowers.forEach(flower => {
                            drawFlower(flower.x, groundY + 15, flower.color, flower.size, flower.phase);
                        });
                    }
                }
                
                // ===== CHARACTER ANIMATIONS =====
                
                const groundLevel = H * 0.75;
                
                // Timeline
                if (time > 700 && !girl.visible) {
                    girl.visible = true;
                    girl.y = -200;
                }
                
                if (girl.visible && girl.y < girl.targetY) {
                    girl.y += (girl.targetY - girl.y) * 0.03;
                    girl.rotation = Math.sin(time * 0.1) * 0.3;
                    girl.legAngle = time * 0.2;
                }
                
                if (girl.y >= girl.targetY - 10 && !girl.dusting && time > 850) {
                    girl.rotation = 0;
                    girl.dusting = true;
                }
                
                if (girl.dusting && time < 1000) {
                    girl.dustPhase += 0.1;
                    girl.armAngle = girl.dustPhase;
                }
                
                if (time > 950 && !boy.visible) {
                    boy.visible = true;
                }
                
                if (boy.visible && boy.x > boy.targetX) {
                    boy.x -= 2;
                    boy.walkPhase += 0.15;
                    boy.legAngle = boy.walkPhase;
                    boy.armAngle = boy.walkPhase;
                }
                
                if (time > 1100 && !cupid.visible) {
                    cupid.visible = true;
                }
                
                if (cupid.visible) {
                    cupid.wingPhase += 0.2;
                    if (cupid.y < cupid.targetY) {
                        cupid.y += (cupid.targetY - cupid.y) * 0.05;
                    }
                    
                    // Shoot arrows
                    if (time > 1250 && cupid.shotsFired === 0) {
                        arrows.push({
                            x: cupid.x,
                            y: cupid.y + 30,
                            targetX: girl.x,
                            targetY: girl.targetY + 30,
                            angle: Math.PI * 0.6,
                            progress: 0
                        });
                        cupid.shotsFired = 1;
                    }
                    
                    if (time > 1300 && cupid.shotsFired === 1) {
                        arrows.push({
                            x: cupid.x,
                            y: cupid.y + 30,
                            targetX: boy.targetX,
                            targetY: boy.y + 30,
                            angle: Math.PI * 0.4,
                            progress: 0
                        });
                        cupid.shotsFired = 2;
                    }
                }
                
                // Update arrows
                arrows.forEach(arrow => {
                    if (arrow.progress < 1) {
                        arrow.progress += 0.03;
                        arrow.x = lerp(cupid.x, arrow.targetX, easeOutQuad(arrow.progress));
                        arrow.y = lerp(cupid.y + 30, arrow.targetY, easeOutQuad(arrow.progress));
                        arrow.angle = Math.atan2(arrow.targetY - cupid.y - 30, arrow.targetX - cupid.x);
                    }
                });
                
                // Hit detection
                if (arrows.length > 0 && arrows[0].progress >= 1 && !girl.hit) {
                    girl.hit = true;
                }
                if (arrows.length > 1 && arrows[1].progress >= 1 && !boy.hit) {
                    boy.hit = true;
                }
                
                // Hearts
                if (girl.hit && boy.hit && time % 10 === 0) {
                    hearts.push({
                        x: W * 0.35 + (Math.random() - 0.5) * 200,
                        y: groundLevel,
                        vy: -2 - Math.random() * 2,
                        size: 0.3 + Math.random() * 0.4,
                        alpha: 1
                    });
                }
                
                hearts.forEach(heart => {
                    heart.y += heart.vy;
                    heart.alpha -= 0.01;
                });
                
                // Show hug
                if (time > 1550 && !showHug) {
                    showHug = true;
                }
                
                // Fade out
                if (time > 1750) {
                    fadeAlpha = Math.min(1, fadeAlpha + 0.01);
                }
                
                // Show end text
                if (time > 1900 && !showEnd) {
                    showEnd = true;
                    document.getElementById('cinemaEnd').style.opacity = '1';
                }
                
                // ===== DRAW CHARACTERS =====
                
                if (cameraY > H * 2.5) {
                    // Draw characters when on ground
                    if (girl.visible && !showHug) {
                        drawPerson(girl.x, girl.y, true, girl);
                    }
                    
                    if (boy.visible && !showHug) {
                        drawPerson(boy.x, boy.y, false, boy);
                    }
                    
                    if (cupid.visible && !showHug) {
                        drawCupid(cupid.x, cupid.y, cupid);
                    }
                    
                    // Arrows
                    arrows.forEach(arrow => {
                        if (arrow.progress < 1) {
                            drawArrow(arrow);
                        }
                    });
                    
                    // Hearts
                    hearts.forEach(heart => {
                        if (heart.alpha > 0) {
                            drawHeart(heart.x, heart.y, heart.size, heart.alpha);
                        }
                    });
                    
                    // Hug
                    if (showHug) {
                        drawHugCouple(W * 0.5, groundLevel - 30);
                    }
                }
                
                // Fade overlay
                if (fadeAlpha > 0) {
                    ctx.fillStyle = `rgba(0, 0, 0, ${fadeAlpha})`;
                    ctx.fillRect(0, 0, W, H);
                }
                
                // Continue animation
                if (!showEnd || fadeAlpha < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            // Easing functions
            function easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
            
            function easeOutQuad(t) {
                return 1 - (1 - t) * (1 - t);
            }
            
            function lerp(a, b, t) {
                return a + (b - a) * t;
            }
            
            // Start animation
            animate();
        }
    </script>
</body>
</html>
